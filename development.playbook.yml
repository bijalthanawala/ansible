---

- name: Setup or update development system
  hosts: development
  vars_files: development_vault_encrypted.yml
  become: true
  vars:
    ansible_become_pass: "{{ development_host_sudo_password }}"

  tasks:
    - name: Ensure that essential development packages are installed
      ansible.builtin.package:
        update_cache: true
        name:
          - git
          - vim
          - jq
          - tree
        state: present


- name: Setup pertinent to proxmox
  hosts: new_proxmox
  vars_files: development_vault_encrypted.yml
  become: true
  vars:
    ansible_become_pass: "{{ development_host_sudo_password }}"

  tasks:
    - name: Install avahi and QEMU guest agent
      ansible.builtin.package:
        update_cache: true
        name:
          - avahi
          - qemu-guest-agent
        state: present

    - name: Enable and run avahi
      ansible.builtin.service:
        name: avahi-daemon.service
        enabled: true
        state: started

    - name: Enable and run QEMU guest agent
      ansible.builtin.service:
        name: qemu-guest-agent.service
        enabled: true
        state: started
